<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
    <script>
        var myCalculator = new Calculator();
        $(document).ready(function() {
            $('.buttons button').click(myCalculator.button_clicked);
        });
        function Calculator() {
            var self = this;
                //stores Calculator's "this" in "self" so it can be used in click handlers
            this.inputs_array = [];
                //placeholder for the array that holds the input objects
            this.index = 0;
                //set this.index to 0 so inputs go into the first space in the array
            this.last_input = {};
                //placeholder for the memory of the object of the last clicked input
            this.history = [];
            this.last_number = null;
                //placeholder for the memory of the value of the last number inputted
            this.last_operation = null;
                //placeholder for the memory of the value of the last operator inputted
            this.button_clicked = function() {
                //method called when the html button elements are clicked
                var clicked_type = $(this).attr('class');
                    //gets the class of the element clicked and stores it in a variable
                var clicked_value = $(this).val();
                    //
                if (clicked_type === "number") {
                    self.number_clicked(clicked_value);
                }
                else if (clicked_type === "operator") {
                    self.operator_clicked(clicked_value);
                }
                else if (clicked_type === "equalSign") {
                    self.equals_clicked();
                }
                else if (clicked_type === "AC") {
                    self.ac_clicked();
                }
                else if (clicked_type === "C") {
                    self.clear_entry_clicked();
                }
                else if (clicked_type === "DEL") {
                    self.delete_clicked();
                }
                console.log(self.inputs_array);
            };
            this.number_clicked = function(clicked_value) {
                var last_value = null;
                if (self.inputs_array.length && self.inputs_array[self.index - 1].type === "number") {
                    self.index--;
                    last_value = self.inputs_array[self.index].value;
                    if (!self.inputs_array[self.index].from_result) {
                        if (clicked_value === "." && last_value.indexOf(".") > -1) {
                            clicked_value = last_value;
                        }
                        else if (last_value === "0" || last_value === "-0" ) {
                            clicked_value = clicked_value;
                        }
                        else if (clicked_value === "-") {
                            if (last_value.indexOf("-") > -1) {
                                clicked_value = last_value.replace("-", "");
                            }
                            else if (last_value.length < 11) {
                                clicked_value = "-" + last_value;
                            }
                            else {
                                clicked_value = last_value;
                            }
                        }
                        else {
                            clicked_value = last_value + clicked_value;
                        }
                    }
                    else {
                        self.last_input = {};
                        self.last_number = null;
                        self.last_operation = null;
                    }
                }
                if (clicked_value === ".") {//decimal point is the first input
                    clicked_value = "0.";
                }
                clicked_value = clicked_value.slice(0,11);
                self.last_input = {"type": "number", "value": clicked_value};
                self.last_number = clicked_value;
                self.inputs_array[self.index] = self.last_input;
                self.index++;
                self.display(clicked_value);
            };
            this.find_value = function(value) {
                //it's like indexOf but it'll find a property of an object in an array
                var index = -1;
                for (var i = 0; i < this.inputs_array.length; i++) {
                    if (this.inputs_array[i].value === value) {
                        index = i;
                        return index;
                    }
                }
            };
            this.operator_clicked = function(clicked_value) {
                if (self.inputs_array.length && self.inputs_array[self.index - 1].type === "operator") {
                    self.index--;
                }
                if (self.index > 2) {
                    //if ( !((clicked_value === "x" || clicked_value === "/") && (self.find_value("+") > -1 || self.find_value("-") > -1)) ) {
                        var solved_value = self.prepare_answer();
                        self.history = [self.inputs_array[0], self.inputs_array[1], self.inputs_array[2]];
                        self.inputs_array = [{"type": "number", "value": solved_value, "history": self.history}];
                        self.index = 1;
                        self.display(solved_value);
                    //}
                }
                self.last_input = {"type": "operator", "value": clicked_value};
                self.last_operation = clicked_value;
                self.inputs_array[self.index] = self.last_input;
                self.index++;
            };
            this.prepare_answer = function() {
                var num1 = null;
                var num2 = null;
                var operator = null;
                var lastIndex = this.inputs_array.length-1;
                var solved_value = null;
                var solution_index = null;
                /*
                if (this.inputs_array.length > 3) {
                    console.log("array needs order of operations");
                    for (var i = lastIndex; i >= 0; i -= 2) {
                        if (this.inputs_array.length - 1 > 0) {
                            solution_index = i - 2;
                            if (this.inputs_array[i].type === "number") {
                                num2 = parseFloat(this.inputs_array[i].value);
                                this.inputs_array.pop();
                                operator = this.inputs_array[i - 1].value;
                                self.last_operation = operator;
                                this.inputs_array.pop();
                                num1 = parseFloat(this.inputs_array[i - 2].value);
                                this.inputs_array.pop();
                            }
                            else {
                                console.log("it's an operator");
                                num2 = null;
                                operator = this.inputs_array[i].value;
                                //this.inputs_array.pop();
                                num1 = parseFloat(this.inputs_array[i - 1].value);
                                //this.inputs_array.pop();
                            }
                        }
                        else {
                            solution_index = 0;
                            num2 = null;
                            operator = null;
                            num1 = parseFloat(this.inputs_array[0].value);
                        }
                        console.log(self.last_number, self.last_operation, self.inputs_array);
                        solved_value = this.do_math(num1, num2, operator);
                        this.inputs_array[solution_index] = {"type": "number", "value": solved_value};
                        self.index = solution_index + 1;
                    }
                }
                else {
                    console.log("array doesn't need order of operations");
                    for (i = 0; i < this.inputs_array.length; i++) {
                        if (this.inputs_array[i].type === "number" && num1 === null) {
                            num1 = this.inputs_array[i].value;
                            num1 = parseFloat(num1);
                        }
                        else if (this.inputs_array[i].type === "number") {
                            num2 = this.inputs_array[i].value;
                            num2 = parseFloat(num2);
                        }
                        else {
                            operator = this.inputs_array[i].value;
                        }
                    }
                }
                */
                for (i = 0; i < this.inputs_array.length; i++) {
                    if (this.inputs_array[i].type === "number" && num1 === null) {
                        num1 = this.inputs_array[i].value;
                        num1 = parseFloat(num1);
                    }
                    else if (this.inputs_array[i].type === "number") {
                        num2 = this.inputs_array[i].value;
                        num2 = parseFloat(num2);
                    }
                    else {
                        operator = this.inputs_array[i].value;
                    }
                }
                if (operator === null && self.last_operation) {
                    operator = self.last_operation;
                    num2 = parseFloat(self.last_number);
                }
                return this.do_math(num1, num2, operator);
            };
            this.equals_clicked = function() {
                var solved_value = self.prepare_answer();
                self.history = [self.inputs_array[0], self.inputs_array[1], self.inputs_array[2]];
                self.inputs_array = [{"type": "number", "value": solved_value, "from_result": true, "history": self.history}];
                self.index = 1;
                self.display(solved_value);
            };
            this.ac_clicked = function() {
                self.index = 0;
                self.inputs_array = [];
                self.last_input = {};
                self.last_number = null;
                self.last_operation = null;
                self.display("");
            };
            this.clear_entry_clicked = function() {
                if (self.index) {
                    self.index--;
                }
                if (self.inputs_array.length) {
                    //if the array has objects in it
                    if (self.inputs_array[self.index].history) {
                        //if the item at the current index (after decrement) has a history property
                        console.log("current index", self.index);
                        self.inputs_array = self.inputs_array[self.index].history;
                        self.index = 3;
                        console.log("current index", self.index);
                        self.display(self.inputs_array[self.inputs_array.length - 1].value);
                    }
                    else {
                        //the item at the current index (after decrement) doesn't have history property
                        self.inputs_array.pop();
                        //remove the last object from the array
                        if (self.index) {
                            self.index--;
                            //decrement the index again
                        }
                        if (self.inputs_array.length) {
                            //if the array still has objects after pop();
                            for (var i = 0; i < self.inputs_array.length; i++) {
                                if (self.inputs_array[i].type === "number") {
                                    self.last_number = self.inputs_array[i].value;
                                }
                                else {
                                    self.last_operation = self.inputs_array[i].value;
                                }
                            }
                            if (self.inputs_array[self.index].type === "operator") {
                                self.inputs_array.pop();
                                if (self.index) {
                                    self.index--;
                                    //decrement the index again
                                }
                                self.display(self.inputs_array[self.index].value);
                            }
                            else {
                                //pop() removed the last object in the array
                                self.last_number = null;
                                self.last_operation = null;
                                self.display("");
                            }
                            self.index++;
                        }
                    }
                }
            };
            this.delete_clicked = function() {
                if (self.index) {
                    self.index = self.inputs_array.length - 1;
                    var obj = self.inputs_array[self.index];
                    if (obj.value.length > 1) {
                        obj.value = obj.value.substring(0, obj.value.length - 1);
                        self.display(obj.value);
                        self.index++;
                    }
                    else {
                        self.inputs_array.pop();
                        self.display("");
                    }
                }
            };
            this.display = function(input) {
                $('.display-main').text(input);
            };
            this.do_math = function(num1, num2, operator) {
                var result = null;
                if (num1 === null) {
                    num1 = 0;
                }
                if (num2 === null) {
                    num2 = num1;
                    this.last_number = num2;
                }
                if (operator === null) {
                    this.last_operation = null;
                    this.last_number = null;
                    return num1;
                }
                if (operator === "+") {
                    result = num1 + num2;
                }
                else if (operator === "-") {
                    result = num1 - num2;
                }
                else if (operator === "*" || operator === "x" || operator === "X"){
                    result = num1 * num2;
                }
                else if (operator === "/") {
                    if (num2 === 0) {
                        return "ERROR";
                    }
                    else {
                        result = num1 / num2;
                    }
                }
                else { //invalid input
                    return "ERROR";
                }
                if (result > 99999999999 || result < -9999999999) {
                    return "ERROR";
                }
                var result_string = "" + result;
                result_string = result_string.split(".");
                var exp = 10 - result_string[0].length;
                if (exp > 0) {
                    result = Math.round(result * Math.pow(10, exp)) / Math.pow(10, exp);
                }
                return result;
            };
        }
    </script>
    <style>
        @font-face {
            font-family: digital-7;
            src: url(digital-7.ttf);
        }
        .main {
            background-color: #333;
            position:relative;
            margin:auto;
            text-align:center;
            width: 20vw;
            min-width:305px;
            /*height: 25vw;*/
            min-height: 400px;
            padding:20px;
            border-radius: 10px;
            border: 3px solid #555;
            border-bottom: 0;
            box-shadow: 0 3px #222;
        }
        .display-container {
            border-radius: 5px;
            margin: 20px;
        }
        .display{
            height:50px;
            border:2px solid lightseagreen;
            font-family: digital-7, sans-serif;
            color: #3f553f;
            font-size:50px;
            text-align:right;
            overflow:hidden;
            position:relative;
        }
        .display-bg {
            user-select: none;
            width:100%;
            height:100%;
            background-color:darkseagreen;
            color: #89b289;
            position:absolute;
            box-shadow:inset 2px 5px 2px #465c46;
        }
        .display-main {
            width:100%;
            position:absolute;
            z-index:2;
        }
        .buttons {
            text-align:center;
            height:100%;
            margin:auto;
            position:relative;
        }
        #panel-container {
            text-align:left;
            width:10vw;
            height:25px;
            margin: 0px 10px;
            color:white;
        }
        .panel {

        }
        .buttons button {
            width:22%;
            height:50px;
            font-size: 20px;
            font-weight: bold;
            margin:2px 0;
            background-color: #009dd3;
            color:#dcdcdc;
            cursor: pointer;
            border: 2px solid #00b4f5;
            border-bottom: 0;
            border-radius: 5px;
            box-shadow: 0 2px #007095;
            outline: none
        }
        .buttons .number:active {
            transform: translateY(2px);
            box-shadow:inset 0 0 #007095;
        }
        .buttons .operator {
            background-color: #dcdcdc;
            border: 2px solid #f5f5f5;
            border-bottom: 0;
            box-shadow: 0 2px #aaa;
            color:black;
        }
        .buttons .operator:active {
            transform: translateY(2px);
            box-shadow:inset 0  0 #aaa;
        }
        .buttons .equalSign {
            /*width:45%;*/
            background-color: #d4dc00;
            border: 2px solid #edf500;
            border-bottom: 0;
            box-shadow: 0 2px #939700;
            color:black;
        }
        .buttons .equalSign:active {
            transform: translateY(2px);
            box-shadow:inset 0 0 #939700;
        }
        .buttons .AC, .buttons .C, .buttons .DEL {
            background-color: #8b0000;
            border: 2px solid #a00000;
            border-bottom: 0;
            box-shadow: 0 2px #4D0000;
            color:#dcdcdc;
        }
        .buttons .AC:active, .buttons .C:active, .buttons .DEL:active {
            transform: translateY(2px);
            box-shadow:inset 0 0 #4D0000;
        }
    </style>
</head>
<body>
<div class="calc main">
    <div class="display-container">
        <div class="display">
            <div class="display-bg">
                88888888888
            </div>
            <div class="display-main">
            </div>
        </div>
    </div>
    <div id="panel-container">
        <div class="panel">calculator</div>
    </div>
    <div class="buttons">
        <!--
        <br>
        <button class="number" value="^">^</button>
        <button class="operator" value="√">√</button>
        <br>
        <button class="number" value="3.141592653">π</button>
        <button class="number" value="(">(</button>
        <button class="number" value=")">)</button>
        <button class="operator" value="%">%</button>
        -->
        <br>
        <button class="AC" value="AC">C</button>
        <button class="C" value="C">CE</button>
        <button class="DEL" value="DEL">DEL</button>
        <button class="operator" value="/">÷</button>
        <br>
        <button class="number" value="7">7</button>
        <button class="number" value="8">8</button>
        <button class="number" value="9">9</button>
        <button class="operator" value="x">x</button>
        <br>
        <button class="number" value="4">4</button>
        <button class="number" value="5">5</button>
        <button class="number" value="6">6</button>
        <button class="operator" value="-">-</button>
        <br>
        <button class="number" value="1">1</button>
        <button class="number" value="2">2</button>
        <button class="number" value="3">3</button>
        <button class="operator" value="+">+</button>
        <br>
        <button class="number" value="-">+ / -</button>
        <button class="number" value="0">0</button>
        <button class="number" value=".">.</button>
        <button class="equalSign" value="=">=</button>
        <br>
    </div>
</div>
</body>
</html>